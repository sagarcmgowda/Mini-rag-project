# Mini RAG Project: Industrial Safety Document Q&A System

This project implements a Retrieval-Augmented Generation (RAG) system to answer questions about industrial safety. It uses a vector database (FAISS) for semantic search and a hybrid reranker to improve the relevance of results. The system is exposed via a simple Flask API.

## Project Deliverables

-   **Code:** `ingest.py`, `reranker.py`, and `app.py`
-   **Data:** `sources.json` and a file containing 8 questions.
-   **Documentation:** This `README.md` file, which explains the setup, how to run the project, and a detailed analysis of the results.

---

## Setup and Installation

Follow these steps to set up the project on your local machine.

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/sagarcmgowda/Mini-rag-project.git
    cd mini-rag-project
    ```
2.  **Create and activate a virtual environment:**
    ```bash
    python -m venv venv
    .\venv\Scripts\activate
    ```
3.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **Add data files:**
    Ensure you have `industrial-safety-pdfs.zip` and `sources.json` in the project's root directory.

---

## How to Run

1.  **Run the data ingestion script:** This will unzip the PDFs, chunk the text, create embeddings, and build the FAISS index and SQLite database.
    ```bash
    python ingest.py
    ```
2.  **Start the Flask API:** Open a new terminal window and start the Flask development server. This terminal must remain open and running.
    ```bash
    python app.py
    ```
3.  **Send requests:** Use `curl` from a separate terminal to interact with the API.

---

## Example:

Here are two example requests to test the API for both search modes.

### Baseline Search Example

This command uses cosine similarity to find the most relevant chunks.

```bash
curl -X POST [http://127.0.0.1:5000/ask](http://127.0.0.1:5000/ask) -H "Content-Type: application/json" -d "{\"q\": \"What is the Machinery Regulation?\", \"k\": 3, \"mode\": \"baseline\"}"
```

### Reranker Search Example

This command uses a hybrid approach (cosine similarity + BM25 keyword search) to rerank the results for better accuracy.

```bash
curl -X POST [http://127.0.0.1:5000/ask](http://127.0.0.1:5000/ask) -H "Content-Type: application/json" -d "{\"q\": \"How to protect workers from amputations?\", \"k\": 5, \"mode\": \"reranker\"}"
```

### Results and Findings
The following table summarizes the results for the 8 questions, comparing the performance of the baseline and reranker modes.
| Question | Baseline Result | Reranker Result | Better Performer |
|----------|----------------|----------------|----------------|
| Q1: What is risk assessment? | "I am sorry, but the most relevant information found has a low confidence score." | <details><summary>View Answer</summary>"5 Safety functions and their contribution to risk reduction The hazards are then identified; all phases of the The objective of the further procedure is to reduce the risk machine\u2018s lifetime must be considered in this process. In to an acceptable level. For this purpose, Figure 5.3 shows addition to automatic mode, particular attention is paid to the proportions of risk reduction with and without safety- operating modes requiring manual intervention, e.g. for: related parts of a control system. Further information on the subject of risk can be found in the IFA Manual [19]. \u2022 Setting \u2022 Testing 5.2.2 Risk evaluation \u2022 Teaching/programming \u2022 Commissioning Following the risk estimation, a risk evaluation is per- \u2022 Material charging formed in order to determine whether a risk reduction is \u2022 Retrieval of the product necessary. The criteria for adequate risk reduction are \u2022 Troubleshooting and fault clearance specified in EN 12100 [3]: \u2022 Cleaning \u2022 Maintenance \u2022 Have all operating conditions and all intervention pro- cedures been considered? Further details of this process step can be found in EN ISO 12100 [3]. A range of methods exist for systematic \u2022 Have hazards been eliminated by suitable protective identification of the hazards; examples can be found measures or the risks reduced to the lowest practicable in ISO/DTR 14121-2 [4]. Possible hazards are also listed level? extensively in EN ISO 12100 [3]. Figure 5.2 shows an excerpt. \u2022 Has it been ensured that the measures taken do not give rise to new hazards? 5.2.1 Risk estimation \u2022 Have the users been sufficiently informed and warned Once all potential hazards which may be presented by the concerning the residual risks? machine have been identified, the risk must be estima- ted for each hazard. The risk associated with a particular \u2022 Has it been ensured that the protective measures taken hazardous situation can be determined from the following do not adversely affect the operators\u2018 working condi- risk elements: tions or the usability of the machine? a) Severity of harm \u2022 Are the protective measures taken compatible with one another? b) Probability of this harm occurring as a function of: \u2013 Exposure of a person/of persons to the hazard \u2022 Has sufficient consideration been given to the conse- \u2013 A hazardous event occurring quences that can arise from the use in a non-profes- \u2013 The technical and human possibilities for avoidance sional/non-industrial context of a machine designed for or limitation of the harm professional/industrial use? Electric shock Obstacles Counter-rotating rollers Automatic machinery: Crushing hazard may start without warning Figure 5.2: Examples of hazards (source: German Hand injuries Social Accident Insurance Institution for the food stuffs and catering industry) 27"</details> | Reranker |
| Q2: How to protect workers from amputations? | "Safeguarding Equipment and Protecting Employees from Amputations Occupational Safety and Health Administration U.S. Department of Labor OSHA3170-02R 2007" | <details><summary>View Answer</summary>"Hazardous Activities Controlling Amputation Employees operating and caring for machinery Hazards perform various activities that present potential amputation hazards. Safeguarding is essential for protecting employees from needless and preventable injury. A good rule Machine set-up/threading/preparation,* to remember is: Machine inspection,* Any machine part, function, or process that may Normal production operations, cause injury must be safeguarded. Clearing jams,* Machine adjustments,* In this booklet, the term primary safeguarding Cleaning of machine,* methods refers to machine guarding techniques Lubricating of machine parts,* and that are intended to prevent or greatly reduce the Scheduled and unscheduled maintenance.* chance that an employee will have an amputation injury. Refer to the OSHA general industry (e.g., * These activities are servicing and/or mainte- Subpart O) and construction (e.g., Subparts I and nance activities. N) standards for specific guarding requirements. Many of these standards address preventive meth- Hazard Analysis ods (such as using barrier guards or two-hand trip- You can help prevent workplace amputations by ping devices) as primary control measures; while looking at your workplace operations and identify- other OSHA standards allow guarding techniques ing the hazards associated with the use and care of (such as a self-adjustable table saw guard) that the machine. A hazard analysis is a technique that reduce the likelihood of injury. Other less protective focuses on the relationship between the employee, safeguarding methods (such as safe work methods) the task, the tools, and the environment. When that do not satisfactorily protect employees from evaluating work activities for potential amputation the machine hazard areas are considered second- hazards, you need to consider the entire machine ary control methods. operation production process, the machine modes Machine safeguarding must be supplemented of operation, individual activities associated with by an effective energy control (lockout/tagout) the operation, servicing and maintenance of the program that ensures that employees are protected machine, and the potential for injury to employees. from hazardous energy sources during machine The results from the analysis may then be used servicing and maintenance work activities. as a basis to design machine safeguarding and an Lockout/tagout plays an essential role in the pre- overall energy control (lockout/tagout) program. vention and control of workplace amputations. In This is likely to result in fewer employee amputa- terms of controlling amputation hazards, employ- tions; safer, more effective work methods; reduced ees are protected from hazardous machine work workers\u2019 compensation costs; and increased em- activities either by: 1) effective machine safeguard- ployee productivity and morale. ing, or 2) lockout/tagout where safeguards are ren- dered ineffective or do not protect employees from hazardous energy during servicing and mainte- nance operations. Additionally, there are some servicing activities, such as lubricating, cleaning, releasing jams and making machine adjustments that are minor in nature and are performed during normal produc- tion operations. It is not necessary to lockout/ tagout a machine if the activity is routine, repetitive and integral to the production operation provided that you use an alternative control method that affords effective protection from the machine\u2019s hazardous energy sources. Safeguarding Machinery The employer is responsible for safeguarding machines and should consider this need when pur- chasing machinery. Almost all new machinery is SAFEGUARDING EQUIPMENT AND PROTECTING EMPLOYEES FROM AMPUTATIONS 9"</details> | Reranker |
| Q3: What is a safeguarding device? | "I am sorry, but the most relevant information found has a low confidence score." | <details><summary>View Answer</summary>"3A \u2013 DEFINING THE SAFETY FUNCTIONS Temporarily preventing access Access to a hazardous point is prevented until the machine is in a safe state. Examples: \u2022 On request, a machine stop is initiated. When the machine reaches the safe state, the blocking of access by the safety locking device is released. \u2022 After disconnecting the power, a transfer key that allows access (opening the movable physical guard) is enabled. Figure 20: Temporarily preventing access to the hazardous point in a stretch film wrapper by means of a safety locking device Retaining parts/substances/radiation If parts can be ejected out of machines or radiation can arise, mechanical protective devices (physical guards) must be used to prevent these hazards. Examples: \u2022 Protection hood with special viewing window on a milling machine to protect against ejected shav\u2010 ings and tool parts \u2022 Fence that can hold back a robot Figure 21: Retention of shavings in a processing machine by means of a protection hood 44 SPECIAL INFORMATION | Reranker |
| Q4: What are the requirements for safety-related parts of control systems? | "I am sorry, but the most relevant information found has a low confidence score." | <details><summary>View Answer</summary>"12/22 PU05907001Z-EN 9 noitcudortnI Risk reduction through the use of safety-related parts of control Risk reduction through the use of safety-related parts of control systems systems The parts of machine control systems that handle safety tasks are defined in international standards as the \u201csafety-related parts of control systems\u201d The parts of machine control systems that handle safety tasks are defined (SRP/CS). These parts can consist of hardware or software and can be in international standards as the \u201csafety-related parts of control systems\u201d separate or integrated elements of the machine control system. Safety- (SRP/CS). These parts can consist of hardware or software and can be related control system parts comprise the entire safety function consisting separate or integrated elements of the machine control system. Safety- of the input level (sensor), the logic (safety signal processing) and the related control system parts comprise the entire safety function consisting output level (actuator). of the input level (sensor), the logic (safety signal processing) and the output level (actuator). The general objective is to design these control system parts so that the safety of the control function and the behavior of the control system in The general objective is to design these control system parts so that the the event of a fault match the level of risk reduction determined in the risk safety of the control function and the behavior of the control system in assessment. the event of a fault match the level of risk reduction determined in the risk assessment. EN ISO 12100 Safety of machinery Risk assessment and risk reduction Functional and safety requirements for safety related control systems EN IEC 62061 EN ISO 13849 Safety of machinery Safety of machinery Functional safety of safety related Safety-related part of electrical, electronic and programm- control systems able electronic control systems IEC 60204 Safety of machinery Electrical equipment of machines Figure 1: New normative situation International Standardization Organisation International Electrotechnical Commission The ISO is a worldwide association of standards organizations. The IEC is a global organization that draws up and publishes It draws up and publishes international standards primarily for international standards for electrical engineering and non-electrical technologies. associated technologies." </details> | Reranker |
| Q5: What is the Machinery Regulation? | "I am sorry, but the most relevant information found has a low confidence score." | <details><summary>View Answer</summary>"\u00a7 \u2013 LAWS, DIRECTIVES, STANDARDS NOTE The directives are freely available, e.g., at eur-lex.europa.eu. NOTE European directives apply to manufacturers and organizations that place machinery on the market in the Euro\u2010 pean Union. The Machinery Directive Machinery Directive 2006/42/EC addresses the manufacturers and distributors of machines and safety compo\u2010 nents. It establishes the necessary tasks for new machines to meet health and safety requirements in order to dismantle trade barriers within Europe and to guarantee a high level of health and safety for users and operators. It applies to machines and to safety components individually placed on the markets, as well as to used machines and safety components from third-party countries which are placed on the market in the European Economic Area for the first time (e.g., from the USA or Japan). \u2022 In 1989, the Council of the European Community passed the directive on the approximation of the laws of the Member States relating to machinery, known as the Machinery Directive (89/392/EEC). \u2022 By 1995, this directive had to be applied in all EC Member States. \u2022 In 1998, various amendments were summarized and consolidated in the Machinery Directive 98/37/EC. \u2022 in 2006, the Machinery Directive 2006/42/EC, which replaced the previous version, was passed. All EC member states were obliged to adopt the new directive by December 29, 2009. NOTE As of December 29, 2009 only Machinery Directive 2006/42/EC is to be implemented! NOTE The Machinery Directive was implemented in the German-speaking countries as follows: \u2022 Germany: Ninth Ordinance (Machinery Ordinance / 9. ProdSV) to the Product Safety Act (ProdSG) dated November 8, 2011 \u2022 Switzerland: Federal law on product safety (PrSG) dated June 12, 2009 and Ordinance on the safety of machinery (Machinery Ordinance) dated April 2, 2008 \u2022 Austria: Federal act on protection against dangerous products (Product Safety Act 2004 [PSG 2004]) and Machine safety ordinance 2010 If machinery and safety components comply with the Machinery Directive, member states may not prohibit, restrict or impede their being placed on the market and put into service. It is also forbidden for them to apply national laws, ordinances, or standards to impose more stringent requirements! The Work Equipment Directive The obligations for employers are set out in the Work Equipment Directive, which applies to the use of machinery and equipment in the workplace. The directive contains minimum requirements that must be met when using work equipment in order to improve occupational health and safety. Each member state may add its own national requirements: e.g., regarding equipment testing, service and maintenance intervals, the use of personal protective equipment, or the layout of the workplace. The requirements of the Work Equipment Directive as well as national requirements and operating regulations are in turn implemented in national laws. 12 SPECIAL INFORMATION| Reranker |
| Q6: What is SISTEMA? | "I am sorry, but the most relevant information found has a low confidence score." | <details><summary>View Answer</summary>"Annex H: SISTEMA: the software utility for evaluation of SRP/CS H.1 What is SISTEMA capable of? effects of the changes assessed with little effort. The final results are summarized in a report, which can be printed The SISTEMA software utility (SISTEMA is the German out. acronym for safety of control systems on machines) pro- vides developers and testers of safety-related machine H.2 How is SISTEMA used? controls with comprehensive support in the evaluation of safety in the context of EN ISO 13849-1. The tool, which SISTEMA processes basic elements from a total of six runs on Windows, enables the structure of the SRP/CS hierarchical levels: the project (PR), the safety function to be modelled based upon \u201cdesignated architectures\u201d, (SF), the subsystem (SB), the channel (CH)/test channel and ultimately permits automated calculation of the reli- (TE), the block (BL) and the element (EL). The relationship ability values at various levels of detail, including that of between them is shown briefly below (Figure H.1). the attained Performance Level (PL) and the probability of failure (PFH ). The user first opens a project, in which the machine or D hazard zone that is to be analysed in greater detail can be Relevant parameters, such as the risk parameters for defined. Safety functions are then assigned to the project. determining the required P\u00dcerformance Level (PL), the The safety functions can be defined and documented, r Category of the SRP/CS, the measures against common and a PL assigned to them. The PL actually attained by r cause failure (CCF) on multi-channel systems, the mean the parameterized SRP/CS is determined automatically time to dangerous failure (MTTF ) and the diagnostic from the subsystems which \u2013 in a series arrangement D coverage (DC) of components and blocks, are entered \u2013 execute the safety function. Each subsystem is based step by step in input dialogs. Once the required data have upon a \u201cdesignated architecture\u201d from the standard, as a been entered into SISTEMA, the results are calculated and function of the selected Category. The architecture deter- displayed virtually instantly: each parameter change is mines, among other things, whether the control system reflected immediately on the user interface with its impact is of single-channel, single-channel tested or redundant upon the entire system. Users are for the most part spared design, and whether a special test channel must be consi- time-consuming consultation of tables and calculation dered during evaluation. Each channel can be subdivided using formulae (calculation of the MTTF by means of in turn into any desired number of blocks, for which either D the parts count method, symmetrization of the MTTF for an MTTF value and a DC value are entered directly, or \u2013 D D each channel, estimation of the DC , calculation of the on the lowest level in the hierarchy \u2013 the values for the avg PFH and PL, etc.), since these tasks are performed by the individual elements of which the block is composed. D software. This enables parameter values to be varied and BL = block PR = project SF = safety function EL1 EL2 SB = subsystem EL = element CH = channel EL3 EL4 I1 L1 O1 I2 L2 O2 TE = test channel TE OTE Figure H.1: Hierarchy levels considered in SISTEMA 301" </details> | Reranker |
| Q7: What is the purpose of a safety circuit? | "I am sorry, but the most relevant information found has a low confidence score." | <details><summary>View Answer</summary>"Inherent stability functions are performed: Property of a switching device that switches off at specified voltages at \u2022 The hazardous machine functions \u201ccovered\u201d by the guard cannot a current expected in the event of a short-circuit (the prospective short- operate until the guard is closed and locked; circuit current) at any level (greater than 100 kA), without being affected in \u2022 The guard remains closed and locked until the risk due to the hazardous its function (conducting current, tripping in the event of an overload). machine functions \u201ccovered\u201d by the guard has disappeared; Inherent stability is normally obtained by damping components in the \u2022 When the guard is closed and locked, the hazardous machine functions switching device which reduce a short-circuit current so that it can be \u201ccovered\u201d by the guard can operate. The closure and locking of the switched off by the contact system. With circuit-breakers and motor- guard do not by themselves start the hazardous machine functions. protective circuit-breakers for small rated operating currents, this is Isolating (VDE 0100 Part 200) caused by the resistance in the bimetal trip and in the winding of the Disconnection of the entire system, a part of the system or a device from short-circuit release. Larger switching devices obtain this effect by the all conductors which are not grounded. fast and wide opening of the contacts, leading quickly to an arc resistance which also limits the current. Inherent stability mainly applies to switching Isolating function (IEC 60947) devices with small rated currents due to the increasing mass inertia of the The function of switching devices whose switching contacts, when contact system of large circuit-breakers. opened, achieve the required isolation for isolating circuits. The entire system or part of the system can thus be disconnected from the supply to Intended use of a machine (EN ISO 12100-1) ensure safety, e. g. during maintenance work. Use of a machine in accordance with the information provided in the instructions for use. Isolation and dissipation of energy (EN ISO 14118) Procedure which consists of the following four steps: Interlock The interlock of a locking device with retainer, mechanically prevents that a) Isolating (switch off, disconnection) the machine (or defined parts) from the locking system returns to the locked position when the safety guard is all supply sources. open. b) Locking (or securing in another way) of all isolating devices in the \u201cisolated position\u201d if required (e.g. with large machines or plants). Interlocking device, interlock (EN ISO 12100-1) c) Dissipating or retaining any stored energy which can cause a hazard. Mechanical, electrical or other type of device, the purpose of which is Note: Energy as c) can be stored, for example, in: to prevent the operation of hazardous machine functions under specified conditions (generally as long as a guard is not closed). \u2022 Mechanical parts which continue to move due to mass inertia; \u2022 Mechanical parts which can move under gravity; Interlocking guard (EN ISO 12100-1) \u2022 Capacitors, accumulators; Guard associated with an interlocking device so that, together with the \u2022 Pressurized media; control system of the machine, the following functions are performed: \u2022 Springs. \u2022 The hazardous machine functions \u201ccovered\u201d by the guard cannot d) Ensure by means of safe operation that the above measures as per a), operate until the guard is closed; b) and c) have the required effect. \u2022 If the guard is opened while hazardous machine functions are Key-operated pushbutton (IEC 60947-5-1) operating, a stop command is given; Pushbutton which can only be operated with the key inserted. When the guard is closed, the hazardous machine functions \u201ccovered\u201d by the guard can operate. The closure of the guard does not by itself start the Lambda hazardous machine functions. Failure rate (per hour) of a channel in a subsystem. Interlocking guard with a start function (EN ISO 12100-1) Lifetime Special form of an interlocking guard which, once it has reached its closed Service life [h] of safety related components. position, gives a command to initiate the hazardous machine function(s) without the use of a separate start control. Light grid, light curtain, light barrier An opto-electronic system consisting of a sender and receiver. EN ISO 12100-2:2003, 5.3.2.5, gives detailed provisions regarding the An interruption of the emitted light beams generates a signal which conditions of use. can be processed further in a control system. Interlocking guard with guard locking (EN ISO 12100-1) Guard associated with an interlocking device and a guard locking device so that, together with the control system of the machine, the following 12/22 PU05907001Z-EN 149 1.31 xidneppA" </details> | Reranker |
| Q8: How to calculate Performance Level (PL)? | "I am sorry, but the most relevant information found has a low confidence score." | <details><summary>View Answer</summary>"Example: Determining the PL of the \u201cpower control elements\u201d subsystem 6) Evaluation of process measures Fulfilled Similarly, systematic aspects for the avoidance and management of faults must be taken into account. For example: \u2022 Organization and competence \u2022 Rules governing design (e.g., specifications templates, coding guidelines) \u2022 Test concept and test criteria \u2022 Documentation and configuration management 7) Result 10-4 The PL of the subsystem can be determined from the figure for a determining the PL of the subsystem (see \"Determining the achieved b Performance Level (PL)\", page 130). In this case, the PL \u201ce\u201d has c been achieved. The resulting PFH value of 2.47 \u00d7 10\u20138 for this subsystem can be d D obtained from a detailed table in ISO 13849-1. The high DC means e that the dual-channel structure meets the requirements of category 4. PFHD value 10-5 10-6 10-7 10-8 DC None None Low Medium Low Medium High Category B 1 2 2 3 3 4 )LP( leveL ecnamrofreP 3D \u2013 VERIFYING THE SAFETY FUNCTION NOTE With the resulting data for the subsystem, it is now possible to determine the performance level of the entire safety function achieved (see \"Determining the achieved Performance Level (PL)\", page 130). Alternative: Determining the achieved safety integrity level (SIL) The achieved safety integrity level (SIL) according to IEC 62061 is determined based on the following criteria: \u2022 The safety integrity of the hardware Structural restrictions (SIL claim limit) \u00b0 Probability of dangerous hardware failures (PFH ) \u00b0 D \u2022 The requirements for systematic safety integrity Avoidance of failures \u00b0 Management of systematic errors \u00b0 Here \u2013 similar to ISO 13849-1 \u2013 to determine the PL the safety function is first broken down into function blocks and then transferred to subsystems. Figure 115: Subsystems in the safety chain: safety light curtain. Logic unit, contactor Safety integrity of the hardware When considering the overall safety function, the safety integrity of the hardware is determined by the following factors ... 138 SPECIAL INFORMATION| Reranker |



